# GeeCache JMeter æ€§èƒ½æµ‹è¯•æŒ‡å—

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£… JMeter
```bash
# macOS ä½¿ç”¨ Homebrew
brew install jmeter

# æˆ–ä»å®˜ç½‘ä¸‹è½½ï¼šhttps://jmeter.apache.org/download_jmeter.cgi
```

### 2. å¯åŠ¨ GeeCache æœåŠ¡
```bash
# å¯åŠ¨å•èŠ‚ç‚¹æœåŠ¡
go run main.go -port=8001

# æˆ–å¯åŠ¨å¤šèŠ‚ç‚¹ï¼ˆæ¨èï¼‰
go run main.go -port=8001 &
go run main.go -port=8002 &
go run main.go -port=8003 &
```

### 3. é¢„çƒ­ç¼“å­˜ï¼ˆå¯é€‰ï¼‰
```bash
# é¢„çƒ­å‡ ä¸ªå¸¸ç”¨é”®ï¼Œç¡®ä¿åç»­æµ‹è¯•å‘½ä¸­ç¼“å­˜
curl -s 'http://localhost:8001/_geecache/scores/Tom'
curl -s 'http://localhost:8001/_geecache/scores/Jack'
curl -s 'http://localhost:8001/_geecache/scores/Sam'
```

### 4. å¯åŠ¨ JMeter GUI æµ‹è¯•
```bash
# å¯åŠ¨ JMeter å¹¶åŠ è½½æµ‹è¯•è®¡åˆ’
jmeter -t geecache_performance_test.jmx
```

## ğŸ“Š æµ‹è¯•åœºæ™¯è¯´æ˜

### åœºæ™¯ä¸€ï¼šç¼“å­˜å‘½ä¸­æµ‹è¯•ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
- **ç›®æ ‡**ï¼šæµ‹è¯•ç¼“å­˜å‘½ä¸­æ—¶çš„æœ€å¤§ QPS
- **é…ç½®**ï¼š200 å¹¶å‘çº¿ç¨‹ï¼ŒæŒç»­ 30 ç§’
- **è¯·æ±‚**ï¼šå›ºå®šè®¿é—® `/_geecache/scores/Tom`
- **é¢„æœŸ**ï¼šQPS åº”è¾¾åˆ° 10K+

### åœºæ™¯äºŒï¼šéšæœºé”®æµ‹è¯•ï¼ˆé»˜è®¤ç¦ç”¨ï¼‰
- **ç›®æ ‡**ï¼šæµ‹è¯•ç¼“å­˜ç©¿é€å’Œ SingleFlight æ•ˆæœ
- **é…ç½®**ï¼š100 å¹¶å‘çº¿ç¨‹ï¼ŒæŒç»­ 30 ç§’
- **è¯·æ±‚**ï¼šä» CSV æ–‡ä»¶éšæœºé€‰æ‹©é”®
- **é¢„æœŸ**ï¼šè§‚å¯Ÿ SingleFlight åˆå¹¶æ•ˆæœ

## ğŸ¯ å…³é”®æŒ‡æ ‡è§£è¯»

### Summary Report å…³é”®æŒ‡æ ‡ï¼š
- **Throughput**ï¼šååé‡ï¼ˆè¯·æ±‚/ç§’ï¼‰ï¼Œç›®æ ‡ >10,000/sec
- **Average**ï¼šå¹³å‡å“åº”æ—¶é—´ï¼Œç›®æ ‡ <10ms
- **Error %**ï¼šé”™è¯¯ç‡ï¼Œç›®æ ‡ 0%
- **90% Line**ï¼š90% è¯·æ±‚çš„å“åº”æ—¶é—´

### Graph Resultsï¼š
- å®æ—¶æŸ¥çœ‹å“åº”æ—¶é—´è¶‹åŠ¿
- è§‚å¯Ÿç³»ç»Ÿç¨³å®šæ€§

### Aggregate Reportï¼š
- è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
- åŒ…å«æœ€å°å€¼ã€æœ€å¤§å€¼ã€æ ‡å‡†å·®ç­‰

## âš™ï¸ è°ƒä¼˜å»ºè®®

### æå‡ QPS çš„é…ç½®è°ƒæ•´ï¼š

1. **å¢åŠ å¹¶å‘æ•°**ï¼š
   - å³é”® "Cache Hit Test" â†’ Edit
   - è°ƒæ•´ "Number of Threads" åˆ° 400-800

2. **è°ƒæ•´æµ‹è¯•æ—¶é•¿**ï¼š
   - ä¿®æ”¹ "Duration (seconds)" åˆ° 60 æˆ–æ›´é•¿

3. **ç³»ç»Ÿä¼˜åŒ–**ï¼š
   ```bash
   # å¢åŠ æ–‡ä»¶æè¿°ç¬¦é™åˆ¶
   ulimit -n 65536
   
   # æŸ¥çœ‹ç³»ç»Ÿ CPU æ ¸æ•°
   sysctl -n hw.ncpu
   ```

### æµ‹è¯•ä¸åŒåœºæ™¯ï¼š

1. **å¯ç”¨éšæœºé”®æµ‹è¯•**ï¼š
   - ç¦ç”¨ "Cache Hit Test"
   - å¯ç”¨ "Random Keys Test"
   - è§‚å¯Ÿ SingleFlight æ•ˆæœ

2. **æ··åˆæµ‹è¯•**ï¼š
   - åŒæ—¶å¯ç”¨ä¸¤ä¸ªæµ‹è¯•ç»„
   - è§‚å¯Ÿç³»ç»Ÿåœ¨æ··åˆè´Ÿè½½ä¸‹çš„è¡¨ç°

## ğŸ“ˆ ç»“æœåˆ†æ

### è¾¾åˆ° 10K+ QPS çš„æ ‡å¿—ï¼š
- Summary Report ä¸­ Throughput > 10000/sec
- Error % = 0%
- Average response time < 20ms

### æ€§èƒ½ç“¶é¢ˆæ’æŸ¥ï¼š
1. **CPU ä½¿ç”¨ç‡**ï¼š`top` å‘½ä»¤æŸ¥çœ‹ Go è¿›ç¨‹ CPU å ç”¨
2. **å†…å­˜ä½¿ç”¨**ï¼šè§‚å¯Ÿå†…å­˜æ˜¯å¦å……è¶³
3. **ç½‘ç»œè¿æ¥**ï¼š`netstat -an | grep 8001` æŸ¥çœ‹è¿æ¥æ•°

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜ï¼š

1. **è¿æ¥è¢«æ‹’ç»**ï¼š
   - ç¡®è®¤ GeeCache æœåŠ¡å·²å¯åŠ¨
   - æ£€æŸ¥ç«¯å£ 8001 æ˜¯å¦è¢«å ç”¨

2. **QPS è¾ƒä½**ï¼š
   - å¢åŠ å¹¶å‘çº¿ç¨‹æ•°
   - æ£€æŸ¥ç³»ç»Ÿèµ„æºé™åˆ¶
   - ç¡®ä¿ä½¿ç”¨ç¼“å­˜å‘½ä¸­åœºæ™¯

3. **é”™è¯¯ç‡é«˜**ï¼š
   - æ£€æŸ¥æœåŠ¡æ—¥å¿—
   - ç¡®è®¤è¯·æ±‚è·¯å¾„æ­£ç¡®
   - éªŒè¯æ•°æ®æºé…ç½®

## ğŸ“ ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

### å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰ï¼š
```bash
# é GUI æ¨¡å¼è¿è¡Œï¼Œç”Ÿæˆ HTML æŠ¥å‘Š
jmeter -n -t geecache_performance_test.jmx -l results.jtl -e -o report

# æŸ¥çœ‹æŠ¥å‘Š
open report/index.html
```

### ä¿å­˜æµ‹è¯•ç»“æœï¼š
1. åœ¨ GUI ä¸­å³é”® Summary Report â†’ Save Table Data
2. ä¿å­˜ä¸º CSV æ ¼å¼ï¼Œä¾¿äºåç»­åˆ†æ

---

**æç¤º**ï¼šé¦–æ¬¡æµ‹è¯•å»ºè®®å…ˆç”¨è¾ƒå°çš„å¹¶å‘æ•°ï¼ˆå¦‚ 50ï¼‰ï¼Œç¡®è®¤ç³»ç»Ÿæ­£å¸¸åå†é€æ­¥å¢åŠ åˆ°ç›®æ ‡å¹¶å‘æ•°ã€‚